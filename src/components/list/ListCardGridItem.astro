---
import type { UserListCard } from "../../models/UserListCard";
import ListCardActions from "./ListCardActions.astro";
import { languages } from "../../constants/languages";
import { variants } from "../../constants/variants";
interface Props {
  listCard: UserListCard | null;
  listType: string;
}

const { listCard, listType } = Astro.props;
const language = languages.find(({ code }) => code === listCard?.lang);
const type = variants.type.find(({ code }) => code === listCard?.variant);
const stamp = variants.stamp.find(({ code }) => code === listCard?.stamp);
const foil = variants.foil.find(({ code }) => code === listCard?.foil);
---

<div class="cardItem cardItemEffect">
  <ListCardActions listCard={listCard} />

  <div>
    <a href={`/card/${listCard?.cardId}`}>
      {
        listCard?.image ? (
          <img
            class={
              `cardItem-image ` + (listCard?.image ? "" : "cardItem-not-found")
            }
            src={listCard?.image || "/img/card-not-found.jpg"}
            alt={listCard?.cardId || ""}
            title={listCard?.cardName || ""}
            loading="lazy"
            decoding="async"
            fetchpriority="low"
            sizes="(max-width: 640px) 150px, (max-width: 1024px) 200px, 250px"
            style="background-color: #1f2937;"
            data-lang={language?.lang}
            onerror={listCard?.image ? "changeImageLang(this)" : undefined}
          />
        ) : (
          <div class="cardItem-image cardItem-not-found" title="Normal">
            &nbsp;
          </div>
        )
      }

      <div
        class="capitalize grid grid-cols-2 gap-2 items-start px-1"
        style="grid-template-columns: 1fr auto;"
      >
        <span>
          {listType == "pokedex" ? listCard?.dexId : listCard?.cardId} -
          {listCard?.pokemonName}
        </span>
        <span class="flex flex-nowrap gap-1" style="justify-content: flex-end;">
          {
            listCard?.stamp != null && listCard?.stamp !== "" && (
              <div
                class={`variant-flag variant-${stamp?.code} w-[1rem] h-[1rem] mt-1 inline`}
                title={stamp?.name}
              >
                &nbsp;
              </div>
            )
          }
          {
            listCard?.foil != null && listCard?.foil != "" && (
              <div
                class={`variant-flag variant-${foil?.code} w-[1rem] h-[1rem] mt-1 inline`}
                title={foil?.name}
              >
                &nbsp;
              </div>
            )
          }
          {
            listCard?.variant != null && listCard?.variant != "" && (
              <div
                class={`variant-flag variant-${type?.code} w-[1rem] h-[1rem] mt-1 inline`}
                title={type?.name}
              >
                &nbsp;
              </div>
            )
          }
          {
            (listCard?.cardName != "" || listCard?.lang != "") && (
              <div
                class={`language-flag lang-${language?.lang} w-[1rem] h-[1rem] mt-1 inline`}
                title={language?.name}
              >
                &nbsp;
              </div>
            )
          }
        </span>
      </div>
    </a>
  </div>
</div>
