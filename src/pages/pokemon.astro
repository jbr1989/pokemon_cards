---
import { createClient } from "@libsql/client/web";

export const turso = createClient({
  url: import.meta.env.TURSO_DATABASE_URL,
  authToken: import.meta.env.TURSO_AUTH_TOKEN,
});

async function fetchAndInsertPokemon() {
  const MAX_POKEMON = 1025;

  for (let id = 1; id <= MAX_POKEMON; id++) {
    try {
      const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
      const data = await response.json();
      const name = data.name;

      const result = await turso.execute({
        sql: "INSERT OR IGNORE INTO pokemon (id, name) VALUES (?, ?)",
        args: [id, name],
      });

      console.log(result);
      console.log(`Insertado: ${id} - ${name}`);

      await new Promise((resolve) => setTimeout(resolve, 250)); // Evitar abusar de la API
    } catch (err) {
      console.error(`Error con ID ${id}:`, err.message);
      await new Promise((resolve) => setTimeout(resolve, 1000));
    }
  }

  console.log("âœ… Finalizado");
}

fetchAndInsertPokemon();
---
